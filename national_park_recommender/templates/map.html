{% extends "base.html" %}

{% block title %}World Park Map{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
crossorigin=""></script>
<style>
    #map_canvas { 
        height: 600px; 
        width: 100%;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl">
    <h1 class="text-3xl md:text-4xl font-bold text-green-700 mb-8 text-center">World National Park Map</h1>
    
    <p class="text-center text-gray-600 mb-6">
        Explore national parks and significant sites globally. Click on a marker for more information.
        (This is a basic implementation. More features can be added!)
    </p>

    <div id="map_canvas"></div>

    <div class="mt-10 text-center">
        <a href="{{ url_for('index') }}" class="text-green-600 hover:text-green-800 font-medium transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Back to Recommendations
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the map and set its view to a default location and zoom
        var map = L.map('map_canvas').setView([20, 0], 2); // Centered roughly globally, zoomed out

        // Add a tile layer to the map (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Get park data passed from Flask
        var parks = {{ parks_for_map | tojson }};

        parks.forEach(function(park) {
            if (park.lat && park.lon) {
                var marker = L.marker([park.lat, park.lon]).addTo(map);
                marker.bindPopup("<b>" + park.name + "</b><br><a href='/park/" + park.id + "'>View Details</a>");
            }
        });
    });
</script>
{% endblock %}